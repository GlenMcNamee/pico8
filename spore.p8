pico-8 cartridge // http://www.pico-8.com
version 15
__lua__
----- spurt
---
---

function _init()
 player = 37
 mud = 19
	barrel = 5
	barrier1 = 41
	barrier2 = 45
 sport = 49
 bullet = 15
 gamemode = 2
 dx = {-1,1,0,0}
 dy = {0,0,-1,1}
end

function _update()
 if gamemode == 0 then _intro() end   
 if gamemode == 1 then _titlescreen() end   
 if gamemode == 2 then _initgame() end   
 if gamemode == 3 then _initlevel() end   
 if gamemode == 4 then _maingameloop() end   
 if gamemode == 5 then _endgame() end   
end

function _intro()     
 last = time()
 gamemode = 1
end

function _titlescreen()
 if btnp(4) and time() > last then
  gamemode = 2
 end
end   

function _initgame()
 barrels = 0
 level = 1
 lives = 3
 gamemode = 3
end

function _initlevel()
  _drawlevel()
  death = 0
  gamemode = 4
end

function _drawlevel()
 npc = 0
 maxbarrels = 0 
 npcx = {} -- npc y
 npcy = {} -- npc x
 npcd = {} -- npc direction

 calcy = flr(level/8)
 calcx = level - (calcy*8)

 lx = calcx * 16
 ly = calcy * 16

 for y=0, 15 do
  for x=0, 15 do
   mset(x,y,mget(lx+x,ly+y))
   --- set up player.
   if mget(lx+x,ly+y)==37 then
    px = x
    py = y
    --mset(x,y,1)
   end

   if mget(lx+x,ly+y)==bullet then
    bulx = x
    buly = y
    buld = 1
   end
   
   if mget(lx+x,ly+y)>sport-1 and mget(lx+x,ly+y)<sport+4 then
  //  if mget(lx+x,ly+y)==18 then maxbarrels += 1 end
    npcx[npc] = x
    npcy[npc] = y

    npc += 1
    --mset(lx+x,ly+y,1)
   end
  end
 end
 barrells = 0
 maxnpc = npc
end

function _endgame()
 if btnp(4) and time() > last+1 then
  gamemode = 0
 end
end   




















-->8
----

function _maingameloop()
// if mget(px,py) == player then
  _ply()
  _bullet()
// else
//  death +=1
//  mset(flr(rnd(16)),flr(rnd(16)),3)
//  if death > 100 then
//   lives -= 1
//   if lives < 0 then
//    gamemode = 1
//   else
//    gamemode = 3
//   end
//  end
// end
 _npc()

end
-->8
--- player
--
--
---
--
--
--

function _ply()
 nx = px
 ny = py
 if btn(0) then nx = px - 1 end
 if btn(1) then nx = px + 1 end
 if btn(2) then ny = py - 1 end
 if btn(3) then ny = py + 1 end
 if nx < 0 or nx > 15 then nx = px end
 if ny < 0 or ny > 15 then ny = py end
 if mget(nx,ny) == 0 or mget(nx,ny) == 6 then
  mset(px,py,0)
  px = nx
  py = ny
  mset(nx,ny,37)
 end

 if mget(nx,ny) == barrel then
  mset(px,py,0)
  px = nx
  py = ny
  mset(nx,ny,player)
  barrels += 1
  if barrels == maxbarrels then cls(7) end
 end
 
 
end


-->8
---- npc
--
-- npcx
-- 
-- npcy
--
----

function _npc()
 for npc=0, maxnpc-1 do
  onpc = mget(npcx[npc],npcy[npc])
  mset(npcx[npc],npcy[npc],0)
  nnx=npcx[npc] 
  nny=npcy[npc]
  if flr(rnd(2))==0 then
   if npcx[npc] > px then nnx = npcx[npc] - .5 end
   if npcx[npc] < px then nnx = npcx[npc] + .5 end    
  else
   if npcy[npc] > py then nny = npcy[npc] - .5 end
   if npcy[npc] < py then nny = npcy[npc] + .5 end    
  end
  if mget(nnx,nny) == 0 then
   npcx[npc] = nnx
   npcy[npc] = nny
  end
  if mget(nnx,nny) > 18 and mget(nnx,nny) < 27 then
    temp = mget(nnx,nny) 
    if temp == 26 then temp = 0 else temp += 1 end
    mset(nnx,nny,temp)
    
  end
  
  mset(npcx[npc],npcy[npc],onpc)
 end

 for y=0, 15 do
  for x=0, 15 do
   tempmap = mget(x,y)
   if tempmap > barrier1-1 and tempmap < barrier1+4 then
   	if tempmap == barrier1+3 then
   	 mset(x,y,barrier1)
   	else
   	 mset(x,y,tempmap+1)
   	end
   end
   
   if tempmap > barrier2-1 and tempmap < barrier2+4 then
   	if tempmap == barrier2+3 then
   	 mset(x,y,barrier2)
   	else
   	 mset(x,y,tempmap+1)
   	end
   end
   
   if tempmap > sport-1 and tempmap < sport+4 then
   	if tempmap == sport+3 then
   	 mset(x,y,sport)
   	else
   	 mset(x,y,tempmap+1)
   	end
   end
   
  end
 end
end
-->8
---- bullet
-- 

function _bullet()
 mset(bulx,buly,0)
   
 if mget(bulx+dx[buld+1],buly+dx[buld+1])==0 then 
  bulx += dx[buld+1]
  buly += dy[buld+1]
 else
  bulx = -0
  buly = -0
  buld = 0 
 end 
 mset(bulx,buly,15)
end

---

---
--
--

-->8


function _draw()
	cls(0)
 if gamemode == 1 then
  --- draw title screen
 end 
 
 if gamemode == 4 then
  _gui()
  map(0,0,0,0,16,16)
 end
end

function _gui()
end

__gfx__
000000000004600027777777277777770000000000777700000cc0002777777777777777224444772244447700aa000077777777224444776600660000000000
000000000004600022777777286666670000000007111170000cc0002277777777777777224444777244447700a00a0077777777224444770066006600080000
000000000004600022444477285555670aa00aa0017777c000cccc00224444444444447722444444444444770000aa00444444442244447766006600008e8000
00000000666666662244447728400567aa00aa000111ccc00cccccc022444444444444772244444444444477000aa00044444444224444770066006608e7e800
00000000444464442244447728400567a00aa00a01ccccc00cccc7c02244444444444477224444444444447700aa0000444444442244447766006600008e8000
0000000000046000224444772844446700aa00aa0111ccc00ccc7cc02244444444444477224444444444447700a00a0044444444224444770066006600080000
000000000004600022222227288888870000000000cccc0000cccc00224444722244447722222222222222270000aa0022222222224444776600660000000000
0000000000046000222222222222222200000000000000000000000022444477224444772222222222222222000aa00022222222224444770066006600000000
000000500000000000444400cccccccccccccccc00cccccc00cccccc00cccc000000cc000000cc00000000007777777707700000000006000060000000077000
500005000000000044666644cccccccccccc00cccccc00cccccc00cccccc00cc00cc00cc00cc000000cc00007777777777770000000067600676000000777700
050550000044440044666644cccccccccc00cccccc00cccccc00cccccc0000cccc0000cccc0000cc000000007777777777777000000670766707600000777700
005555004466774444667744ccccccccccccccccc0cccc0000cccc0000cccc0000cccc000000cc000000cc007777777707770700006707600670760000770700
005505004466774444667744cccccccccccc00cccccc00cccccc00cccccc00cc00cc00cc00000000000000007777777700077007067076000067076000770700
000550500044440044667744cccccccc00cccccc00cccccc00cccccc00cccc000000cc000000cc00000000007777777700077007670760000006707600700700
005000050000000044666644cccccccccccccccccccc00cccccc00cccc0000cccc0000cccc0000cc000000cc7777777700007007067600000000676000700700
005000000000000000444400cccccccccccccccccc00cccccc00cc00cc00cc000000cc0000000000000000007777777700007770006000000000060000077000
0007700007700000000000000000077050055555000a0000000000a000a00000000000000000000000000000000000000000000000aa0000000aa0000000aa00
0077770077770000000000000000700700005555000a0000a0000a0000a00000000000000000000000000000000000000000000000a00a0000aa0000000aa000
0077770077777000077777700007700700000555000aa0000a0aa000000aa0aa000000000aa00aa000aa00aaa00aa00aaa00aa000000aa0000a00a0000aa0000
007707000777070077700007007700705000505500aaaaaa00aaaa0000aaaa0000000000aa00aa000aa00aa000aa00aaa00aa00a000aa0000000aa0000a00a00
0077070000077007777770070770070055500550aaaa0a0000aa0a0000aa0a0000000000a00aa00aaa00aa000aa00aa000aa00aa00aa0000000aa0000000aa00
0070070000077007077777707777700055500550000aa000000aa0a0aa0aa0000000000000aa00aaa00aa00aaa00aa000aa00aa000a00a0000aa0000000aa000
00700700000070070000000077770000555505500000a00000a0000a00000a0000000000000000000000000000000000000000000000aa0000a00a0000aa0000
00077000000077700000000007700000555500050000a00000a0000000000a000000000000000000000000000000000000000000000aa0000000aa0000a00a00
00a00a00000000000000000000444400000000000000000000000000000000000000000000033000033000000000000000000330000000000000000000000000
0000aa00000000000044440004888840004444000000000000000000000000000000000000333300333300000000000000003bb3000000000000000000000000
000aa000004444000488884004888840048888400000000000000000000000000000000000333300333330000333333000033bb3000000000000000000000000
00aa000004887740048877400488774004887740000000000000000000000000000000000033b3000333b300333bbbb30033bb30000000000000000000000000
00a00a0004887740048877400488774004887740000000000000000000000000000000000033b30000033bb333333bb3033bb300000000000000000000000000
0000aa000044440004888840048877400488884000000000000000000000000000000000003bb30000033bb30333333033333000000000000000000000000000
000aa0000000000000444400048888400044440000000000000000000000000000000000003bb30000003bb30000000033330000000000000000000000000000
00aa0000000000000000000000444400000000000000000000000000000000000000000000033000000033300000000003300000000000000000000000000000
__map__
0204040404040404040404041e3231050229292929292929292929291e323105000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000002d3132310000000000000000000000002d313231000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000208002d3231340000000000000000000208002d323134000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000002500000f00000d002d313231000000002500000f00000d002d313200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000d002d323134000000000000000000000d002d323100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000708000000000d002d313231000000000708000000000d002d313200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000002090c0c0c0c0a002d3231340000000002090c0c0c0c0a002d323134000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000204040400000000000000000000000002292929000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000229292929020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000003100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000300000003000000000300000000000003000000030000320003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000050505050505050505050505000000000505050505050505050505050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000003300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000013131313131313131313131313131313000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000031323334313233343132333434313233340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000041424344414243444142434444414243440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000051525354515253545152535454515253540000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000061626364616263646162636464616263640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
